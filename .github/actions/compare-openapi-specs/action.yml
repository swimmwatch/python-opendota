name: "Compare OpenAPI specifications"
description: "Compare OpenAPI specifications using openapi-diff tool."

inputs:
  old-spec-path:
    required: true
    description: "Old specification file path"
  new-spec-path:
    required: true
    description: "New specification file path"

outputs:
  state:
    description: "Ð¡omparison result"
    value: ${{steps.check-diff-spec.outputs.state}}
  markdown-changes:
    description: "Changes content in markdown"
    value: ${{steps.changes.outputs.content}}

runs:
  using: "composite"
  steps:
    - name: "Find difference using openapi-diff tool"
      id: check-diff-spec
      run: |
        res=$(utils/diff-spec.sh ${{inputs.old-spec-path}} ${{inputs.new-spec-path}})
        echo "::set-output name=state::$res"
      shell: bash
    - name: "Read changes Markdown file file"
      id: changes
      uses: juliangruber/read-file-action@v1
      with:
        path: "changes.md"
    - name: "Remove changes.md"
      run: rm changes.md
      shell: bash